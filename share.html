<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dream Oracle ‚Äî Share</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- html2canvas -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background:#020617;
      color:#f1f5f9;
      min-height:100vh;
    }
  </style>
</head>

<body class="flex items-center justify-center p-4">

  <!-- CARD CONTAINER -->
  <div id="capture"
       class="w-full max-w-md bg-[#020617] rounded-3xl shadow-[0_0_60px_rgba(0,0,0,.7)] border border-slate-700/50 overflow-hidden">

    <!-- HEADER -->
    <div class="p-6 border-b border-white/10 flex justify-between items-center">
      <div class="flex items-center gap-2 text-[#9b0aa5]">
        <i data-lucide="zap" class="w-5 h-5"></i>
        <span class="font-bold tracking-widest text-xs uppercase text-slate-300 font-mono">IQOS</span>
      </div>
      <a href="./" class="text-slate-500 hover:text-white transition-colors text-xs font-mono">
        Home
      </a>
    </div>

    <!-- CONTENT -->
    <div id="content" class="p-6 flex flex-col gap-6"></div>

    <!-- ACTIONS -->
    <div class="p-6 border-t border-white/10 flex flex-col gap-3">
      <!-- üî• VIOLA PI√ô SCURO -->
      <button onclick="shareInstagram()"
              class="w-full bg-[#581c87] hover:bg-white hover:text-[#581c87]
                     shadow-[0_0_30px_rgba(155,10,165,0.35)]
                     transition-all rounded-xl py-3 text-sm font-bold uppercase tracking-widest">
        Condividi su Instagram
      </button>

      <button onclick="downloadImage()"
              class="w-full bg-slate-900 border border-slate-700 hover:border-white/30
                     transition-all rounded-xl py-3 text-xs uppercase tracking-widest text-slate-300">
        Scarica immagine
      </button>
    </div>
  </div>

<script>
/* ---------------- CARD TEXT DATABASE ---------------- */

const CARD_CONTENT = {
  EXPANSION:{
    real:"√à un segnale concreto: c'√® un'opportunit√† tangibile davanti a te. Non restare fermo, occupa questo nuovo spazio con azioni pratiche e decise. Pi√π spazio dai alla curiosit√†, pi√π possibilit√† emergono.",
    surreal:"Il sogno ti mostra un orizzonte senza confini. Lasciati scivolare in questo varco onirico dove la logica si sospende e l'impossibile diventa probabile. Stai entrando in una fase di apertura assoluta.",
    future:"Segnale electric: espansione del sistema rilevata. I tuoi parametri di crescita sono al massimo. Esegui l'upgrade e accedi al livello successivo. Pi√π dati elabori, pi√π possibilit√† emergono."
  },
  MOMENTUM:{
    real:"√à un segnale concreto: hai preso il ritmo giusto nella vita di tutti i giorni. Non fermarti a riflettere troppo, agisci e basta. Quando inizi concretamente, tutto si muove con te.",
    surreal:"Nel sogno corri senza fatica verso una meta invisibile. Segui quella scia luminosa, √® l'inerzia del tuo desiderio che ti trascina oltre il reale. Questo √® il momento di continuare a sognare.",
    future:"Segnale electric: velocit√† di crociera raggiunta. I propulsori sono attivi. Mantieni la traiettoria e brucia le distanze. Il tuo momentum √® inarrestabile."
  },
  ENERGY:{
    real:"√à un segnale concreto: sentiti fisicamente pronto. Usa questa scarica di adrenalina per risolvere un problema pratico che ti trascinavi da tempo. Quando segui ci√≤ che ti accende, tutto diventa pi√π fluido.",
    surreal:"Nel sogno sei pura luce vibrante. La tua forma si scioglie per diventare energia pura. Non contenerla, lasciala irradiare ovunque e trasforma il paesaggio onirico intorno a te.",
    future:"Segnale electric: batteria al 100%. Il core del sistema √® instabile ma potente. Canalizza l'output verso i tuoi obiettivi primari per una trasformazione immediata."
  },
  VISION:{
    real:"√à un segnale concreto: ora vedi le cose come stanno veramente. Hai la lucidit√† per pianificare i prossimi passi con precisione chirurgica. La direzione √® chiara.",
    surreal:"Il sogno apre il terzo occhio. Vedi oltre la nebbia della realt√†. Fidati di quelle immagini sfocate, contengono la verit√† che cerchi prima ancora che si manifesti.",
    future:"Segnale electric: scansione a lungo raggio completata. Il target √® agganciato. La tua visione periferica √® aumentata, nulla sfugge alla tua analisi predittiva."
  },
  FLOW:{
    real:"√à un segnale concreto: smetti di nuotare controcorrente. Le cose si risolveranno da sole se allenti la presa e ti rilassi. Lascia che le cose accadano con naturalezza.",
    surreal:"Nel sogno galleggi in un fiume di stelle. Non c'√® gravit√†, non c'√® sforzo. Lasciati trasportare dalla corrente dell'inconscio verso destinazioni inattese.",
    future:"Segnale electric: resistenza azzerata. I dati fluiscono senza colli di bottiglia. Entra in modalit√† stream e segui il flusso delle informazioni senza interferire."
  },
  BALANCE:{
    real:"√à un segnale concreto: metti ordine nel caos quotidiano. Trova un compromesso tra dovere e piacere per ritrovare la stabilit√†. L‚Äôequilibrio nasce dal ritmo giusto.",
    surreal:"Il sogno √® un funambolo sospeso nel vuoto. Sei perfettamente immobile nel centro del ciclone. Respira questa quiete assoluta mentre tutto intorno a te muta.",
    future:"Segnale electric: giroscopi stabilizzati. L'assetto √® perfetto. Il sistema ha raggiunto l'omeostasi ottimale per operare al massimo dell'efficienza."
  },
  DISCOVERY:{
    real:"√à un segnale concreto: c'√® una novit√† dietro l'angolo. Tieni gli occhi aperti domani, un piccolo dettaglio potrebbe cambiarti la giornata. Avvicinati senza aspettative.",
    surreal:"Nel sogno trovi una chiave sconosciuta. Apri quella porta segreta della tua mente. C'√® una meraviglia dimenticata che ti aspetta dall'altra parte.",
    future:"Segnale electric: nuova tech scoperta. Un archivio criptato √® stato sbloccato. Accedi subito ai nuovi dati disponibili per espandere il tuo database."
  },
  CONNECTION:{
    real:"√à un segnale concreto: chiama quella persona. Il contatto umano √® la risorsa che ti manca in questo momento. Ogni incontro genera nuova energia vitale.",
    surreal:"Nel sogno fili d'argento ti legano agli altri. Senti i pensieri di chi ami prima che parlino. Siamo tutti parte di un'unica rete onirica che pulsa all'unisono.",
    future:"Segnale electric: uplink stabilito. La rete neurale √® sincronizzata. Condividi il tuo bandwidth con altri nodi per potenziare il segnale collettivo."
  },
  TRANSFORMATION:{
    real:"√à un segnale concreto: cambia look, cambia strada, cambia abitudine. √à il momento pratico per dare un taglio netto al passato e assumere una nuova forma.",
    surreal:"Nel sogno sei una farfalla che rompe il bozzolo. La tua vecchia pelle cade a terra. Non aver paura di questa metamorfosi sacra, √® un passaggio necessario.",
    future:"Segnale electric: aggiornamento firmware obbligatorio. Il vecchio codice viene sovrascritto. Riavvia il sistema per completare l'evoluzione digitale."
  }
};

/* ---------------- BUILD PAGE FROM URL ---------------- */

const qs = new URLSearchParams(window.location.search);
const card = (qs.get("card") || "").toUpperCase();
const loc  = qs.get("loc") || "";
const vibe = qs.get("vibe") || "";
const img  = qs.get("img") || "";

const bodyText =
  CARD_CONTENT[card] && CARD_CONTENT[card][loc]
    ? CARD_CONTENT[card][loc]
    : "Testo non disponibile";

document.getElementById("content").innerHTML = `
  <div class="flex justify-center">
    <div class="px-4 py-1.5 bg-slate-900/80 border border-slate-700 rounded-full flex items-center gap-3">
      <div class="w-2 h-2 rounded-full bg-[#3750dc] animate-pulse shadow-[0_0_10px_#3750dc]"></div>
      <span class="text-[10px] uppercase tracking-[0.2em] font-bold text-slate-300">
        Frequenza: ${vibe || "-"}
      </span>
    </div>
  </div>

  <div class="relative w-full aspect-[4/5] rounded-3xl bg-slate-800 overflow-hidden border border-slate-700/50">
    <img src="${img}" class="w-full h-full object-cover" alt="${card}">
  </div>

  <div class="text-center space-y-4">
    <span class="text-xs font-bold uppercase tracking-widest text-[#9b0aa5]">ELECTRIC DREAM</span>
    <h2 class="text-4xl font-black uppercase">${card}</h2>
    <div class="h-px w-20 mx-auto bg-white/20"></div>
    <p class="text-lg italic font-light leading-relaxed">
      ‚Äú${bodyText}‚Äù
    </p>
  </div>
`;

lucide.createIcons();

/* ---------------- IMAGE EXPORT ---------------- */

async function createImage() {
  return await html2canvas(document.getElementById("capture"), {
    backgroundColor: "#020617",
    scale: window.devicePixelRatio || 2,
    useCORS: true
  });
}

async function downloadImage() {
  const canvas = await createImage();
  const link = document.createElement("a");
  link.download = "dream-oracle.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
}

async function shareInstagram() {
  const canvas = await createImage();
  const blob = await new Promise(res => canvas.toBlob(res, "image/png"));

  const file = new File([blob], "dream-oracle.png", { type: "image/png" });

  if (navigator.canShare && navigator.canShare({ files: [file] })) {
    await navigator.share({ files: [file], title: "Dream Oracle" });
  } else {
    downloadImage();
    alert("Immagine scaricata. Condividila su Instagram dalla galleria.");
  }
}
</script>

</body>
</html>
